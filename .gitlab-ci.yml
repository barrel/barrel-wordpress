stages:
  - test
  - build
php_syntax_check:
  before_script:
    - apt-get update && apt-get -y install git
  image: php:7
  stage: test
  script: 
    - git diff --diff-filter=ACMR --name-only origin/master -- '*.php' | xargs -L1 php -l
js_lint:
  before_script:
    - npm config set loglevel warn && npm set progress=false
    - npm install -g standard --loglevel=warn
    - cd ./wp-content/themes/$THEME_NAME
  image: node:6
  stage: test
  script: standard
build:
  before_script:
    - apt-get update && apt-get -y install fontforge findutils
    - npm config set loglevel warn && npm set progress=false
    - npm install -g gulp --loglevel=warn
    - npm install --loglevel=warn
    - cd ./wp-content/themes/$THEME_NAME
  stage: build
  only:
    - master
  script: "gulp build"
feature:
  only: /^feature\/.*$/
  image: savaslabs/terminus-docker
  stage: build
  before_script:
    - terminus auth:login --machine-token=$TERMINUS_TOKEN
    - terminus multidev:create $PANTHEON_SITE_ID $CI_COMMIT_REF_NAME